<!DOCTYPE html>
<html>
  <head>
  <title>Ruby Pretzel Colons - CustomInk Technology Blog</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="The Ruby Pretzel Colon is one of my favorite idioms. But it&#39;s salty goodness can be an acquired taste for new Ruby programmers.
There seems to ...">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http:///feed.xml" />
  <link rel="stylesheet" href="/assets/app.css">
  <script type="text/javascript">
  (function(d) {
    var config = {
      kitId: 'tph7yyf',
      scriptTimeout: 3000
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='//use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>

  
  <script src="http://localhost:35729/livereload.js?snipver=1"></script>
  
</head>

  <body class="tb-Post">
    <header class="tb-Header">
  <div class="sb-Wrapper">
    <nav class="tb-Header-home">
      <a href="/" class="tb-Header-home-logo"><img src="/assets/CustomInk_Tech_Color.png"></a>
    </nav>
    <input type="checkbox" id="tb-Header-toggle" />
    <div class="tb-Header-area">
      <label for="tb-Header-toggle" class="tb-Header-toggle" data-open="Menu" data-close="Close" onclick></label>
      <ul class="tb-Header-menu">
        <li class="tb-Header-menu-item">
        
          <a href="/team" class="tb-Header-menu-link">AUTHORS</a>
        
        </li>
        <li class="tb-Header-menu-item">
          <a href="http://customink.com" class="tb-Header-menu-link">CUSTOMINK.COM</a>
        </li>
      </ul>
    </div>
  </div>
</header>

    <div class="tb-Post-main sb-Wrapper">
      <div class="tb-Post-content">
        <h1>Ruby Pretzel Colons</h1>
        <p>The Ruby Pretzel Colon is one of my favorite idioms. But it&#39;s salty goodness can be an acquired taste for new Ruby programmers.
There seems to be an aversion to it&#39;s apparent magic. It is an unusual syntax. But it is easy to understand if you break it
down into it&#39;s parts.</p>

<!--more-->

<p>Here is an example of the pretzel colon:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># general style:</span>
<span class="p">[</span><span class="n">person1</span><span class="p">,</span> <span class="n">person2</span><span class="p">,</span> <span class="n">person3</span><span class="p">].</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span> <span class="n">person</span><span class="p">.</span><span class="nf">name</span> <span class="p">}</span>


<span class="c1"># pretzel style:</span>
<span class="p">[</span><span class="n">person1</span><span class="p">,</span> <span class="n">person2</span><span class="p">,</span> <span class="n">person3</span><span class="p">].</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:name</span><span class="p">)</span>
</code></pre></div>
<p>The pretzel colon style <code>&amp;:</code> is more concise and focused and makes the perfect snack at the ball game.</p>

<p>Let&#39;s break down what is happening here. In the general style, the <code>map</code> is iterating through the array and passing each person object to the block. The block is defined to take a single argument of a person, the block then calls <code>person.name</code> and returns the name of the person.</p>

<p>Using pretzel style, the result is the same, but the block is built for us using the <code>&amp;</code> operator. The <code>&amp;</code> operator calls <code>#to_proc</code> on the object then converts the result into a block. If our object was a lambda or Proc, they return <code>self</code> in their default <code>#to_proc</code> method. But in this case, our object is a Symbol.</p>

<p>The default implementation of <code>#to_proc</code> on Symbol is to return a Proc that takes the first argument and <code>sends</code> itself to the argument. Example pseudo code:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Symbol</span>

  <span class="k">def</span> <span class="nf">to_proc</span>
    <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">object</span><span class="o">|</span> <span class="n">object</span><span class="p">.</span><span class="nf">send</span> <span class="nb">self</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</code></pre></div>
<p>The third act of a magic trick is called the Prestige. Using the default <code>#to_proc</code> defined in <code>Symbol</code>, combining it with <code>&amp;</code> which calls <code>#to_proc</code> and converts the result into a block. We are building a block that takes the person object and sends the symbol to it. Sending <code>:name</code> to person is the same as calling <code>person.name</code>.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># expanded pretzel</span>
<span class="p">[</span><span class="n">person1</span><span class="p">,</span> <span class="n">person2</span><span class="p">,</span> <span class="n">person3</span><span class="p">].</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span> <span class="n">person</span><span class="p">.</span><span class="nf">send</span> <span class="ss">:name</span> <span class="p">}</span>
</code></pre></div>
<p>The combination of the Ruby <code>&amp;</code> operator&#39;s ability to convert objects into blocks and the default implementation of Symbol&#39;s <code>#to_proc</code> combine into a magic pretzel. This makes our code more concise and expressive.</p>

<p>A bit of history on the pretzel colon. This idiom started in Rails ActiveSupport but was eventually moved to Ruby Core. It was removed after Rails 2.3. The git history of the file shows &quot;Marcel Molina authored on Nov 20, 2005&quot;. The pretzel colon is almost 10 years old.</p>

<p>see <a href="https://github.com/rails/rails/blob/2-3-stable/activesupport/lib/active_support/core_ext/symbol.rb">https://github.com/rails/rails/blob/2-3-stable/activesupport/lib/active_support/core_ext/symbol.rb</a></p>

      </div>
      

<div class="tb-Author">
  
    <div class="tb-Author-gravatar">
      <img title="Chris Mar" src="http://www.gravatar.com/avatar/7c9f4c37280d4cf26f9bda785478a09a?s=150"/>
    </div>
  
  <div class="tb-Author-info">
    <time pubdate datetime="2015-06-08T00:00:00-04:00">
      08 Jun 2015
    </time></br>
    by Chris Mar
    <div class="tb-Author-icons">
      
        <span class="tb-Author-icon">
          <a href="http://twitter.com/cmar"><i class="tb-Icon-twitter"></i></a>
        </span>
      
      
        <span class="tb-Author-icon">
          <a href="https://github.com/cmar"><i class="tb-Icon-github"></i></a>
        </span>
      
      
    </div>
  </div>
</div>

    </div>

    

    <div class="tb-Footer">
  <div><small>&copy; 2015 CustomInk, LLC. All rights reserved.</small></div>
  <div><small><a href="http://customink.com">CustomInk</a> is a registered trademark of CustomInk LLC. "T-shirts Unite!" and the "Inky" octopus are trademarks of CustomInk, LLC.</small></div>
</div>

    

    <script src="/assets/app.js"></script>
  </body>
</html>
