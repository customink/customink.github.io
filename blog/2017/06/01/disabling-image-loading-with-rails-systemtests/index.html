<!DOCTYPE html>
<html>
  <head>
  <title>Disabling Image Loading with Rails System Tests - CustomInk Technology Blog</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="Disabling external assets like JavaScript or images can improve the performance of your Rails System Tests. Capybara is the acceptance test framewo...">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://technology.customink.com/feed.xml" />
  <link rel="stylesheet" type="text/css" href="/assets/app-9fb5f199f67c50e99bda49998478901a6afd824fd2bd222f5562e57268788ecd.css">
</head>

  <body class="tb-Post">
    <header class="tb-Header">
  <div class="sb-Wrapper">
    <nav class="tb-Header-home">
      <a href="/" class="tb-Header-home-logo"><img src="/assets/CustomInk_Tech_Color-1460f9e847670e2626e66143266004749ab6c7204a8d5a2ae394613f986c473d.png"></a>
    </nav>
    <input type="checkbox" id="tb-Header-toggle" />
    <div class="tb-Header-area">
      <label for="tb-Header-toggle" class="tb-Header-toggle" data-open="Menu" data-close="Close" onclick></label>
      <ul class="tb-Header-menu">
        <li class="tb-Header-menu-item">
        
          <a href="/team" class="tb-Header-menu-link">AUTHORS</a>
        
        </li>
        <li class="tb-Header-menu-item">
          <a href="http://customink.com" class="tb-Header-menu-link">CUSTOMINK.COM</a>
        </li>
      </ul>
    </div>
  </div>
</header>

    <div class="tb-Post-main sb-Wrapper">
      <div class="tb-Post-content">
        <h1>Disabling Image Loading with Rails System Tests</h1>
        <p>Disabling external assets like JavaScript or images can improve the performance of your Rails System Tests. Capybara is the acceptance test framework abstracted by Rails System Tests. It will load all assets on a page before proceeding to the next step in your test.  Since, we are only testing interactions with Rails System Tests, we can reduce the page load time by ignoring images, external scripts and fonts.</p>

<p><a href="http://weblog.rubyonrails.org/2017/4/27/Rails-5-1-final/">Rails 5.1</a> introduced SystemTestCase. It is a nice abstraction around Capybara providing a sane default configuration. The <code>driven_by</code> configuration method allows you to pass additional options to the underlying ChromeDriver.</p>

<p>If your using the default <code>ApplicationSystemTestCase</code> it is configured to use the <code>:chrome</code> web driver with Selenium. This uses the ChromeDriver executable to communicate with the Chrome browser. Disabling image loading is not immediately obvious.</p>

<p>To disable image loading with the ChromeDriver, you need to configure a profile option that is passed to the Chrome browser. I found the solution on this issue: <a href="https://github.com/webdriverio/webdriverio/issues/1056">Disable image with chromedriver · Issue #1056 · webdriverio/webdriverio · GitHub</a></p>

<p>To disable image loading for Rails SystemTestCase using the ChromeDriver pass the <code>prefs</code> profile option:</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">"test_helper"</span>

<span class="k">class</span> <span class="nc">ApplicationSystemTestCase</span> <span class="o">&lt;</span> <span class="no">ActionDispatch</span><span class="o">::</span><span class="no">SystemTestCase</span>
  <span class="n">driven_by</span> <span class="ss">:selenium</span><span class="p">,</span> <span class="ss">using: :chrome</span><span class="p">,</span> <span class="ss">screen_size: </span><span class="p">[</span><span class="mi">1400</span><span class="p">,</span> <span class="mi">1400</span><span class="p">],</span>
            <span class="ss">options: </span><span class="p">{</span>
              <span class="ss">prefs: </span><span class="p">{</span>
                <span class="ss">profile: </span><span class="p">{</span>
                  <span class="ss">default_content_setting_values: </span><span class="p">{</span> <span class="ss">images: </span><span class="mi">2</span> <span class="p">}</span> <span class="c1"># disable image loading</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>
<p>If you like to learn more about Rails System Tests, I recommend watching <a href="https://youtu.be/sSn4B8orX70">RailsConf 2017: Building Rails ActionDispatch::SystemTestCase Framework by Eileen Uchitelle</a></p>

      </div>
      <div class="tb-Post-author">
        
        
        <div class="tb-Author">
  
    <div class="tb-Author-gravatar">
      <img title="Chris Mar" src="https://www.gravatar.com/avatar/7c9f4c37280d4cf26f9bda785478a09a?s=150"/>
    </div>
  
  <div class="tb-Author-info">
    
      <time pubdate datetime="2017-06-01T00:00:00-04:00">
        01 Jun 2017
      </time></br>
      by Chris Mar
    
    <div class="tb-Author-icons">
      
        <span class="tb-Author-icon">
          <a href="http://twitter.com/cmar"><i class="tb-Icon-twitter"></i></a>
        </span>
      
      
        <span class="tb-Author-icon">
          <a href="https://github.com/cmar"><i class="tb-Icon-github"></i></a>
        </span>
      
      
    </div>
    
      <div class="tb-Author-posts">
        <a href="/authors/chris-mar" class="sb-Btn sb-Btn--secondary sb-Btn--small">
          View All Posts
        </a>
      </div>
    
  </div>
</div>

      </div>
    </div>
    
  <div class="sb-Wrapper">
    <section id="disqus_thread">
    </section>
  </div>
  <script type="text/javascript">
    var disqus_shortname = 'custominktechnologyblog';
    var disqus_identifier = '/blog/2017/06/01/disabling-image-loading-with-rails-systemtests/';
    var disqus_title = "Disabling Image Loading with Rails System Tests";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    <div class="tb-Footer">
  <div><small>&copy; 2018 CustomInk, LLC. All rights reserved.</small></div>
  <div><small><a href="http://customink.com">CustomInk</a> is a registered trademark of CustomInk LLC. "T-shirts Unite!" and the "Inky" octopus are trademarks of CustomInk, LLC.</small></div>
</div>

    
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32456448-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


    <script src="/assets/app-9b22a82c5e39b6e35faf56501565196c2778184fa749c44436f639b4986f61bc.js" type="text/javascript"></script>
  </body>
</html>
